# Linux EDR Telemetry Visibility Experiment  
**CSC 786 – Computer Science Problems**

## Overview
This project evaluates how standard Linux, syscall-focused monitoring mechanisms
(e.g., `auditd` rules for `openat`, `connect`, and `execve`) observe execution
performed via traditional system calls versus execution delegated through
`io_uring`.

In addition to syscall-level visibility, the project integrates a real
endpoint detection and response (EDR) platform (Wazuh) to measure how
out-of-the-box EDR alerting responds to the same activity.

The goal is **not to evade detection**, but to **identify and quantify visibility
gaps** that defenders should understand and mitigate through hardening and
monitoring controls.

---

## Repository Structure

```
.
├── analysis/
│   ├── analysis.ipynb        # Data analysis & visualization (audit + Wazuh)
│   └── README.md
├── data/
│   ├── processed/            # Processed datasets (tracked)
│   └── raw/                  # Raw logs (ignored; local only)
├── environment/
│   ├── 99-edr-baseline.rules # auditd rules used in the experiment
│   ├── README.md
│   └── setup.md
├── scripts/
│   ├── run_tests.sh          # Automated execution & data collection harness
│   └── wazuh_count_alerts_remote.sh
├── traditional/              # Traditional syscall-based programs (C)
├── io_uring/                 # io_uring-based programs (C)
├── Makefile
├── requirements.txt
├── ETHICS.md
├── RUNS.md
└── README.md                 # This file
```

> **Note:** `scripts/run_tests.sh` includes automated Wazuh alert collection and
replaces earlier non-Wazuh versions of the runner.

---

## Experimental Methodology (High-Level)

1. Functionally equivalent programs are compiled:
   - Traditional syscall implementations
   - `io_uring`-based implementations
2. Programs are executed under identical system conditions.
3. Detection visibility is measured at two layers:
   - **Syscall layer:** `auditd` rules monitoring `openat`, `connect`, and `execve`
   - **EDR layer:** Wazuh alerts generated by out-of-the-box rules
4. Per-run audit hits and Wazuh alert counts are recorded into a structured dataset.
5. Results are analyzed using descriptive statistics and visualizations.

---

## System Requirements

- Rocky Linux / RHEL-compatible system
- Kernel with `io_uring` support
- Root privileges (required for `auditd`)
- SSH access from test host → Wazuh manager
- Packages:
  ```bash
  sudo dnf install -y \
    gcc make audit \
    liburing liburing-devel \
    python3 python3-pip
  ```

- Python dependencies:
  ```bash
  pip install -r requirements.txt
  ```

---

## Reproducible Workflow

### 1) Build all binaries
```bash
make clean
make all
```

---

### 2) Load audit rules
```bash
sudo auditctl -R environment/99-edr-baseline.rules
```

Verify:
```bash
sudo auditctl -l
```

---

### 3) Configure Wazuh access (one-time)
The runner script queries the Wazuh manager over SSH to count alerts per execution.

```bash
ssh-keygen -t ed25519 -N "" -f ~/.ssh/id_ed25519
ssh-copy-id root@wazuhmgr
```

Optional environment variables:
```bash
export WAZUH_MANAGER_HOST="wazuhmgr"
export WAZUH_MANAGER_USER="root"
export WAZUH_AGENT_NAME="rocky"   # recommended to isolate the test host
```

---

### 4) Run the experiment
```bash
sudo ./scripts/run_tests.sh 10
```

Artifacts produced:
- `data/processed/runs_<timestamp>.csv` – processed dataset
- `logs/test_run_<timestamp>.log` – execution log (local)
- `data/raw/ENV_<timestamp>.txt` – environment metadata snapshot

The CSV includes:
```
ts_start, ts_end, iteration, case,
file_hits, net_hits, exec_hits,
wazuh_alerts
```

---

### 5) Analyze results
```bash
jupyter notebook
```

Open:
```
analysis/analysis.ipynb
```

The notebook:
- Loads the newest `runs_*.csv`
- Computes descriptive statistics and detection rates
- Compares traditional vs `io_uring` cases
- Generates plots and report-ready tables in `results/`

---

## Output Artifacts

After analysis:
- `results/figures/`
- `results/means_by_case_with_wazuh.csv`
- `results/detect_rates_by_case_with_wazuh.csv`

These artifacts are suitable for direct inclusion in Assignments 4 and 5.

---

## Ethics & Scope
This project:
- Uses only benign test programs
- Does not deploy malware, persistence, or command-and-control
- Focuses on measurement of monitoring and detection visibility

See `ETHICS.md` for a full discussion.

---

## Notes
- Raw audit and Wazuh logs are intentionally excluded from version control.
- Results may vary depending on kernel version, audit rules, and Wazuh rule sets.
- Findings are intended to inform defensive hardening decisions.

---

## Author
Michael Mendoza  
CSC 786 – Dakota State University
